 اضافه کردن مدل‌ها و رویداده
 Models/AccountEvents.cs
Models/Account.cs


در اینجا توضیحاتی درباره دو متد ApplyChange و When در کد پیاده‌سازی شده برای CQRS و Event Sourcing ارائه می‌شود. این متدها در مدیریت تغییرات یک حساب کاربری در سیستم استفاده می‌شوند.

متد ApplyChange
توضیحات:
ورودی:

@event: یک شیء از نوع object که نشان‌دهنده یک رویداد (Event) است. این می‌تواند هر نوع رویداد باشد، مانند ایجاد حساب، واریز پول و یا برداشت پول.
عملکرد:

ذخیره رویداد: این متد ابتدا رویداد دریافتی را به لیست _changes اضافه می‌کند. این کار برای ذخیره تاریخچه تغییرات انجام می‌شود.
فراخوانی متد When: پس از ذخیره‌سازی، متد When با همین رویداد (در واقع نوع خاص آن) فراخوانی می‌شود تا وضعیت را مطابق با آن بروزرسانی کند.

توضیحات:
ورودی:

@event: همانند متد ApplyChange، یک شیء است که نشان‌دهنده یک رویداد خاص است.
عملکرد:

این متد از یک ساختار switch برای شناسایی نوع رویداد استفاده می‌کند و بسته به نوع رویداد دریافتی، تغییرات لازم را روی موجودیت (حساب) اعمال می‌کند:
حساب ایجاد شد (AccountCreated): در این حالت، شناسه حساب (Id) و موجودی اولیه (Balance) بر اساس داده‌های رویداد تنظیم می‌شود.
پول واریز شد (MoneyDeposited): موجودی حساب با مبلغ واریز شده افزایش می‌یابد.
پول برداشت شد (MoneyWithdrawn): موجودی حساب با مبلغ برداشت شده کاهش می‌یابد.
نکات مهم
تاریخچه تغییرات: این دو متد به طور مؤثری تاریخچه تغییرات حساب را مدیریت می‌کنند. هر بار که یک عمل انجام می‌شود (ایجاد، واریز، برداشت)، رویداد مربوطه به لیست _changes افزوده می‌شود.
تفکیک منطق: استفاده از دو متد ApplyChange و When کمک می‌کند تا منطق تغییرات و بروزرسانی وضعیت موجودیت به صورت واضح و مجزا تعریف شود. این مساله موجب بهبود خوانایی و نگهداری کد می‌شود.
قابلیت بازیابی وضعیت: در صورت نیاز، با ذخیره‌سازی این رویدادها، می‌توان وضعیت فعلی حساب را دوباره از طریق رویدادها بازسازی کرد.


Services/AccountService.cs
